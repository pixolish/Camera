cmake_minimum_required(VERSION 3.16)
project(CameraCalibrationISP VERSION 1.0.0)

# Set C++ standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Find required packages
find_package(Qt6 COMPONENTS Core Widgets Multimedia MultimediaWidgets REQUIRED)
find_package(OpenCV REQUIRED COMPONENTS core imgproc calib3d highgui)
find_package(Threads REQUIRED)

# Platform-specific settings
if(WIN32)
    # Windows-specific settings
    add_definitions(-DWIN32_LEAN_AND_MEAN -DNOMINMAX)
    
    # Find DirectShow if available
    find_path(DSHOW_INCLUDE_DIR dshow.h)
    if(DSHOW_INCLUDE_DIR)
        add_definitions(-DHAVE_DSHOW)
        include_directories(${DSHOW_INCLUDE_DIR})
    endif()
    
elseif(UNIX AND NOT APPLE)
    # Linux-specific settings
    find_package(V4L2 REQUIRED)
    find_package(Threads REQUIRED)
    
    # Additional Linux libraries
    set(EXTRA_LIBS ${EXTRA_LIBS} v4l2 pthread)
endif()

# Add project source files
set(SOURCES
    src/CameraCapture.cpp
    src/ISPPipeline.cpp
    src/CalibrationEngine.cpp
    src/ProcessingThread.cpp
    src/MainWindow.cpp
    main.cpp
)

set(HEADERS
    include/CameraCapture.h
    include/ISPPipeline.h
    include/CalibrationEngine.h
    include/ProcessingThread.h
    include/MainWindow.h
)

# Add resources
set(RESOURCES resources/icons.qrc)

# Create executable
add_executable(CameraCalibrationISP ${SOURCES} ${HEADERS} ${RESOURCES})

# Link libraries
target_link_libraries(CameraCalibrationISP
    Qt6::Core
    Qt6::Widgets
    Qt6::Multimedia
    Qt6::MultimediaWidgets
    ${OpenCV_LIBS}
    Threads::Threads
    ${EXTRA_LIBS}
)

# Include directories
target_include_directories(CameraCalibrationISP PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}/include
    ${Qt6Core_INCLUDE_DIRS}
    ${Qt6Widgets_INCLUDE_DIRS}
    ${OpenCV_INCLUDE_DIRS}
)

# Set properties for Windows
if(WIN32)
    set_target_properties(CameraCalibrationISP PROPERTIES
        WIN32_EXECUTABLE TRUE
    )
endif()